<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar System AR</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/controls/OrbitControls.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const SolarSystemAR = () => {
            const mountRef = useRef(null);
            const sceneRef = useRef(null);
            const rendererRef = useRef(null);
            const cameraRef = useRef(null);
            const planetsRef = useRef([]);
            const sunRef = useRef(null);
            const clockRef = useRef(null);
            const controlsRef = useRef(null);
            
            const [arSupported, setArSupported] = useState(false);
            const [isChecking, setIsChecking] = useState(true);
            const [arActive, setArActive] = useState(false);
            const [xrSession, setXrSession] = useState(null);

            // Planet configuration
            const planetData = [
                { name: 'Mercury', size: 0.03, distance: 0.4, speed: 4.7, color: 0x8c7853 },
                { name: 'Venus', size: 0.05, distance: 0.7, speed: 3.5, color: 0xffc649 },
                { name: 'Earth', size: 0.05, distance: 1.0, speed: 3.0, color: 0x6b93d6 },
                { name: 'Mars', size: 0.04, distance: 1.5, speed: 2.4, color: 0xc1440e },
                { name: 'Jupiter', size: 0.15, distance: 2.2, speed: 1.3, color: 0xd8ca9d },
                { name: 'Saturn', size: 0.12, distance: 2.8, speed: 0.9, color: 0xfad5a5 },
                { name: 'Uranus', size: 0.08, distance: 3.3, speed: 0.7, color: 0x4fd0e3 },
                { name: 'Neptune', size: 0.08, distance: 3.8, speed: 0.5, color: 0x4b70dd }
            ];

            // Check AR support
            useEffect(() => {
                const checkARSupport = async () => {
                    if (!navigator.xr) {
                        setIsChecking(false);
                        return;
                    }

                    try {
                        const supported = await navigator.xr.isSessionSupported('immersive-ar');
                        setArSupported(supported);
                    } catch (error) {
                        console.error('Error checking AR support:', error);
                        setArSupported(false);
                    } finally {
                        setIsChecking(false);
                    }
                };

                checkARSupport();
            }, []);

            // Initialize Three.js scene
            useEffect(() => {
                if (!mountRef.current) return;

                const THREE = window.THREE;
                if (!THREE) {
                    console.error('Three.js not loaded');
                    return;
                }

                // Scene setup
                const scene = new THREE.Scene();
                
                // Add starfield background
                const starGeometry = new THREE.BufferGeometry();
                const starMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 2 });
                const starVertices = [];
                for (let i = 0; i < 10000; i++) {
                    const x = (Math.random() - 0.5) * 2000;
                    const y = (Math.random() - 0.5) * 2000;
                    const z = (Math.random() - 0.5) * 2000;
                    starVertices.push(x, y, z);
                }
                starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
                const stars = new THREE.Points(starGeometry, starMaterial);
                scene.add(stars);

                const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                camera.position.set(5, 3, 5);
                camera.lookAt(0, 0, 0);

                const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setClearColor(0x000011);
                renderer.xr.enabled = true;
                mountRef.current.appendChild(renderer.domElement);

                // Add OrbitControls
                let controls = null;
                if (THREE.OrbitControls) {
                    controls = new THREE.OrbitControls(camera, renderer.domElement);
                    controls.enableDamping = true;
                    controls.dampingFactor = 0.05;
                    controls.screenSpacePanning = false;
                    controls.minDistance = 1;
                    controls.maxDistance = 20;
                }

                const clock = new THREE.Clock();

                // Lighting
                const ambientLight = new THREE.AmbientLight(0x404040, 0.4);
                scene.add(ambientLight);
                const sunLight = new THREE.PointLight(0xffffff, 2, 100);
                scene.add(sunLight);

                // Create Sun
                const sunGeometry = new THREE.SphereGeometry(0.2, 32, 32);
                const sunMaterial = new THREE.MeshStandardMaterial({ 
                    color: 0xffff00,
                    emissive: 0xffff00,
                    emissiveIntensity: 0.5
                });
                const sun = new THREE.Mesh(sunGeometry, sunMaterial);
                sun.position.set(0, 0, 0);
                scene.add(sun);

                // Create Planets
                const planets = [];
                planetData.forEach((planetInfo) => {
                    const geometry = new THREE.SphereGeometry(planetInfo.size, 16, 16);
                    const material = new THREE.MeshPhongMaterial({ color: planetInfo.color });
                    const planet = new THREE.Mesh(geometry, material);
                    
                    planet.userData = {
                        distance: planetInfo.distance,
                        speed: planetInfo.speed,
                        angle: Math.random() * Math.PI * 2,
                        name: planetInfo.name
                    };
                    
                    const angle = planet.userData.angle;
                    planet.position.x = Math.cos(angle) * planetInfo.distance;
                    planet.position.y = 0;
                    planet.position.z = Math.sin(angle) * planetInfo.distance;
                    
                    scene.add(planet);
                    planets.push(planet);
                });

                // Animation function
                const animate = () => {
                    const deltaTime = clock.getDelta();
                    
                    if (controls && !arActive) {
                        controls.update();
                    }
                    
                    if (sun) {
                        sun.rotation.y += deltaTime * 0.5;
                    }
                    
                    planets.forEach(planet => {
                        planet.userData.angle += deltaTime * planet.userData.speed * 0.1;
                        
                        const distance = planet.userData.distance;
                        const angle = planet.userData.angle;
                        
                        planet.position.x = sun.position.x + Math.cos(angle) * distance;
                        planet.position.z = sun.position.z + Math.sin(angle) * distance;
                        planet.rotation.y += deltaTime * 2;
                    });
                    
                    renderer.render(scene, camera);
                };

                renderer.setAnimationLoop(animate);

                // Store refs
                sceneRef.current = scene;
                rendererRef.current = renderer;
                cameraRef.current = camera;
                planetsRef.current = planets;
                sunRef.current = sun;
                clockRef.current = clock;
                controlsRef.current = controls;

                const handleResize = () => {
                    camera.aspect = window.innerWidth / window.innerHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(window.innerWidth, window.innerHeight);
                };
                window.addEventListener('resize', handleResize);

                return () => {
                    window.removeEventListener('resize', handleResize);
                    renderer.setAnimationLoop(null);
                    if (controls) controls.dispose();
                    if (mountRef.current && renderer.domElement) {
                        mountRef.current.removeChild(renderer.domElement);
                    }
                    renderer.dispose();
                };
            }, [arActive]);

            // Show AR requirements
            const showARRequirements = () => {
                const requirements = [
                    "‚úì Chrome 81+ on Android OR Safari on iOS 15.4+",
                    "‚úì Device with ARCore support (Android) or LiDAR (newer iPhones/iPads)",
                    "‚úì Camera permissions granted",
                    "‚úì Secure HTTPS connection",
                    "‚úì Sufficient lighting in your environment"
                ];
                
                alert(`AR Requirements:\n\n${requirements.join('\n')}\n\nYour device: ${navigator.userAgent.includes('iPhone') ? 'iOS' : 'Android/Desktop'}\nWebXR support: ${navigator.xr ? 'Available' : 'Not found'}`);
            };

            // Start AR session
            const startAR = async () => {
                if (!rendererRef.current) return;
                
                if (!arSupported) {
                    showARRequirements();
                    return;
                }

                try {
                    if (controlsRef.current) {
                        controlsRef.current.enabled = false;
                    }

                    if (sunRef.current) {
                        sunRef.current.position.set(0, 1.5, -2);
                        planetsRef.current.forEach(planet => {
                            const angle = planet.userData.angle;
                            const distance = planet.userData.distance;
                            planet.position.x = sunRef.current.position.x + Math.cos(angle) * distance;
                            planet.position.y = 1.5;
                            planet.position.z = sunRef.current.position.z + Math.sin(angle) * distance;
                        });
                    }

                    const session = await navigator.xr.requestSession('immersive-ar', {
                        requiredFeatures: ['local', 'hit-test']
                    });

                    await rendererRef.current.xr.setSession(session);
                    setXrSession(session);
                    setArActive(true);

                    session.addEventListener('end', () => {
                        if (controlsRef.current) {
                            controlsRef.current.enabled = true;
                        }
                        
                        if (sunRef.current) {
                            sunRef.current.position.set(0, 0, 0);
                            planetsRef.current.forEach(planet => {
                                const angle = planet.userData.angle;
                                const distance = planet.userData.distance;
                                planet.position.x = Math.cos(angle) * distance;
                                planet.position.y = 0;
                                planet.position.z = Math.sin(angle) * distance;
                            });
                        }

                        setArActive(false);
                        setXrSession(null);
                    });

                } catch (error) {
                    console.error('Failed to start AR:', error);
                    showARRequirements();
                    
                    if (controlsRef.current) {
                        controlsRef.current.enabled = true;
                    }
                }
            };

            return React.createElement('div', {
                style: { 
                    position: 'relative',
                    width: '100vw', 
                    height: '100vh',
                    background: '#000011',
                    color: 'white',
                    fontFamily: 'Arial, sans-serif',
                    overflow: 'hidden'
                }
            }, [
                // Three.js mount point
                React.createElement('div', {
                    key: 'mount',
                    ref: mountRef,
                    style: { position: 'absolute', top: 0, left: 0 }
                }),
                
                // Title overlay
                React.createElement('div', {
                    key: 'title',
                    style: {
                        position: 'absolute',
                        top: '20px',
                        left: '20px',
                        zIndex: 10,
                        background: 'rgba(0,0,0,0.7)',
                        padding: '15px 25px',
                        borderRadius: '15px',
                        border: '1px solid rgba(255,255,255,0.2)'
                    }
                }, [
                    React.createElement('h1', {
                        key: 'h1',
                        style: { 
                            margin: 0,
                            fontSize: '1.5em',
                            background: 'linear-gradient(45deg, #ff6b35, #f7931e)',
                            WebkitBackgroundClip: 'text',
                            WebkitTextFillColor: 'transparent',
                            backgroundClip: 'text'
                        }
                    }, `üåû Solar System ${arActive ? 'AR' : '3D'}`),
                    !arActive && React.createElement('p', {
                        key: 'p',
                        style: { margin: '5px 0 0 0', fontSize: '0.9em', opacity: 0.8 }
                    }, 'üñ±Ô∏è Click & drag to orbit ‚Ä¢ üîÑ Scroll to zoom')
                ]),

                // AR Controls
                React.createElement('div', {
                    key: 'controls',
                    style: {
                        position: 'absolute',
                        top: '20px',
                        right: '20px',
                        zIndex: 10,
                        display: 'flex',
                        gap: '10px'
                    }
                }, [
                    !arActive && React.createElement('button', {
                        key: 'ar-btn',
                        onClick: startAR,
                        style: {
                            padding: '12px 20px',
                            fontSize: '1em',
                            background: arSupported 
                                ? 'linear-gradient(45deg, #ff6b35, #f7931e)' 
                                : 'linear-gradient(45deg, #666, #888)',
                            color: 'white',
                            border: 'none',
                            borderRadius: '25px',
                            cursor: 'pointer',
                            boxShadow: arSupported 
                                ? '0 4px 15px rgba(255,107,53,0.4)' 
                                : '0 4px 15px rgba(102,102,102,0.4)'
                        }
                    }, `üöÄ ${arSupported ? 'Launch AR' : 'AR Info'}`),
                    
                    arActive && React.createElement('button', {
                        key: 'exit-btn',
                        onClick: () => xrSession?.end(),
                        style: {
                            padding: '12px 20px',
                            fontSize: '1em',
                            background: 'rgba(255,0,0,0.8)',
                            color: 'white',
                            border: 'none',
                            borderRadius: '25px',
                            cursor: 'pointer'
                        }
                    }, 'Exit AR')
                ]),

                // Info panel
                React.createElement('div', {
                    key: 'info',
                    style: {
                        position: 'absolute',
                        bottom: '20px',
                        left: '20px',
                        right: '20px',
                        zIndex: 10,
                        background: 'rgba(0,0,0,0.7)',
                        padding: '15px',
                        borderRadius: '15px',
                        border: '1px solid rgba(255,255,255,0.2)',
                        textAlign: 'center'
                    }
                }, [
                    arActive ? React.createElement('p', {
                        key: 'ar-info',
                        style: { margin: 0, fontSize: '0.9em' }
                    }, 'üì± Move your phone around to see the solar system in your space!') : 
                    React.createElement('div', { key: 'normal-info' }, [
                        React.createElement('p', {
                            key: 'p1',
                            style: { margin: '0 0 10px 0', fontSize: '0.9em' }
                        }, 'ü™ê Watch planets orbit the sun in real-time ‚Ä¢ Each planet moves at accurate relative speeds'),
                        arSupported && React.createElement('p', {
                            key: 'p2',
                            style: { margin: 0, fontSize: '0.8em', opacity: 0.8 }
                        }, 'AR available - Click "Launch AR" to place the solar system in your room!')
                    ])
                ]),

                // Loading AR check
                isChecking && React.createElement('div', {
                    key: 'loading',
                    style: {
                        position: 'absolute',
                        top: '50%',
                        right: '20px',
                        transform: 'translateY(-50%)',
                        background: 'rgba(255,255,0,0.2)',
                        padding: '10px 15px',
                        borderRadius: '10px',
                        fontSize: '0.8em',
                        zIndex: 5
                    }
                }, 'Checking AR...')
            ]);
        };

        const { createRoot } = ReactDOM;
        
        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(SolarSystemAR));
    </script>
</body>
</html>
