<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Saturn AR</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
            background: #000;
            color: white;
        }
        
        .status-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #ff6b35;
            z-index: 100;
            text-align: center;
        }
        
        .ar-button {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
        }
        
        .ar-button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        .debug-info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            padding: 10px;
            border-radius: 10px;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .error {
            color: #ff4444;
        }
        
        .success {
            color: #44ff44;
        }
        
        .warning {
            color: #ffaa00;
        }
    </style>
</head>
<body>
    <div class="status-panel">
        <h2>ü™ê Saturn AR</h2>
        <div id="status">Checking your device...</div>
        <button id="ar-button" class="ar-button" disabled>Launch AR</button>
    </div>
    
    <div class="debug-info">
        <strong>Debug Information:</strong>
        <div id="debug-log"></div>
    </div>
    
    <div id="container"></div>

    <script>
        // Debug logging function - this helps us see what's happening
        function debugLog(message, type = 'info') {
            const debugDiv = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : '';
            debugDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            debugDiv.scrollTop = debugDiv.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        // Step 1: Set up Three.js (our 3D drawing tool)
        let scene, camera, renderer;
        let saturn, saturnRings;
        let isARActive = false;

        function initThreeJS() {
            debugLog('üîß Setting up 3D graphics...', 'info');
            
            // Create the 3D world (scene)
            scene = new THREE.Scene();
            
            // Create the camera (your eyes in the 3D world)
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 0, 3);
            
            // Create the renderer (the thing that draws everything)
            renderer = new THREE.WebGLRenderer({ 
                antialias: true, 
                alpha: true,
                powerPreference: "high-performance" // Use better graphics
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x000011, 1); // Dark space color
            renderer.xr.enabled = true; // Enable AR/VR
            
            // Add the renderer to our webpage
            document.getElementById('container').appendChild(renderer.domElement);
            
            debugLog('‚úÖ 3D graphics ready!', 'success');
        }

        function createSaturn() {
            debugLog('ü™ê Creating Saturn...', 'info');
            
            // Create Saturn's body (a sphere)
            const saturnGeometry = new THREE.SphereGeometry(0.3, 32, 32); // Small size for mobile
            
            // Create Saturn's beautiful colors
            const canvas = document.createElement('canvas');
            canvas.width = 256; // Small texture for mobile performance
            canvas.height = 256;
            const ctx = canvas.getContext('2d');
            
            // Draw Saturn's bands (those colored stripes)
            for (let i = 0; i < 256; i++) {
                const hue1 = 30 + Math.sin(i * 0.02) * 10; // Golden colors
                const hue2 = 25 + Math.sin(i * 0.03) * 15; // Slightly different golden
                const lightness = 60 + Math.sin(i * 0.01) * 20; // Varying brightness
                
                ctx.fillStyle = `hsl(${hue1}, 70%, ${lightness}%)`;
                ctx.fillRect(0, i, 256, 1);
            }
            
            const saturnTexture = new THREE.CanvasTexture(canvas);
            const saturnMaterial = new THREE.MeshPhongMaterial({ 
                map: saturnTexture,
                shininess: 30
            });
            
            saturn = new THREE.Mesh(saturnGeometry, saturnMaterial);
            
            // Create Saturn's famous rings
            const ringGeometry = new THREE.RingGeometry(0.35, 0.6, 32); // Ring shape
            const ringMaterial = new THREE.MeshBasicMaterial({ 
                color: 0xccaa88,
                side: THREE.DoubleSide,
                transparent: true,
                opacity: 0.7
            });
            
            saturnRings = new THREE.Mesh(ringGeometry, ringMaterial);
            saturnRings.rotation.x = Math.PI / 2; // Rotate rings to be horizontal
            
            // Group Saturn and rings together
            const saturnGroup = new THREE.Group();
            saturnGroup.add(saturn);
            saturnGroup.add(saturnRings);
            
            // Position Saturn RIGHT IN FRONT so you can't miss it
            saturnGroup.position.set(0, 0, -0.3); // Very close
            saturnGroup.scale.set(4, 4, 4); // Giant size
            
            // Make Saturn glow so it's super visible
            saturn.material.emissive = new THREE.Color(0x222244);
            saturnRings.material.emissive = new THREE.Color(0x221100);
            
            scene.add(saturnGroup);
            
            // Add some light so we can see Saturn
            const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(1, 1, 1);
            scene.add(directionalLight);
            
            debugLog('‚úÖ Saturn created with rings!', 'success');
        }

        function animate() {
            // Make Saturn spin slowly (looks cool!)
            if (saturn) {
                saturn.rotation.y += 0.005;
                saturnRings.rotation.z += 0.003;
            }
            
            renderer.render(scene, camera);
        }

        // Step 2: Check if AR works on this device
        async function checkARSupport() {
            debugLog('üîç Checking if AR works on your device...', 'info');
            
            const statusDiv = document.getElementById('status');
            const arButton = document.getElementById('ar-button');
            
            // Check if WebXR exists
            if (!navigator.xr) {
                debugLog('‚ùå WebXR not found. This browser doesn\'t support AR.', 'error');
                statusDiv.innerHTML = 'AR not supported on this browser';
                showTroubleshooting('no_webxr');
                return;
            }
            
            debugLog('‚úÖ WebXR found!', 'success');
            
            // Check device info
            const userAgent = navigator.userAgent;
            debugLog(`üì± Device: ${userAgent}`, 'info');
            
            try {
                // Test if AR is supported
                const isSupported = await navigator.xr.isSessionSupported('immersive-ar');
                
                if (isSupported) {
                    debugLog('‚úÖ AR is supported!', 'success');
                    statusDiv.innerHTML = 'AR is ready! üöÄ';
                    arButton.disabled = false;
                    arButton.onclick = startAR;
                } else {
                    debugLog('‚ùå AR not supported on this device', 'error');
                    statusDiv.innerHTML = 'AR not supported on this device';
                    showTroubleshooting('ar_not_supported');
                }
            } catch (error) {
                debugLog(`‚ùå Error checking AR support: ${error.message}`, 'error');
                statusDiv.innerHTML = 'Error checking AR support';
                showTroubleshooting('check_error', error);
            }
        }

        // Step 3: Start AR when user clicks the button
        async function startAR() {
            debugLog('üöÄ Starting AR...', 'info');
            
            const arButton = document.getElementById('ar-button');
            arButton.disabled = true;
            arButton.textContent = 'Starting AR...';
            
            try {
                // Ask for camera permission and start AR
                debugLog('üì∑ Requesting camera permission...', 'info');
                const session = await navigator.xr.requestSession('immersive-ar');
                debugLog('‚úÖ AR session created!', 'success');
                
                // Set up AR rendering
                renderer.setClearColor(0x000000, 0); // Transparent background for AR
                
                // Connect the session to our renderer
                await renderer.xr.setSession(session);
                debugLog('‚úÖ Renderer connected to AR!', 'success');
                
                isARActive = true;
                arButton.textContent = 'AR Active!';
                
                // Update status
                document.getElementById('status').innerHTML = 'Look around to see Saturn! ü™ê';
                
                // When AR ends, reset everything
                session.addEventListener('end', () => {
                    debugLog('üëã AR session ended', 'info');
                    isARActive = false;
                    renderer.setClearColor(0x000011, 1); // Back to space background
                    arButton.disabled = false;
                    arButton.textContent = 'Launch AR';
                    document.getElementById('status').innerHTML = 'AR ready to launch again!';
                });
                
                // Start the animation loop
                renderer.setAnimationLoop(animate);
                
            } catch (error) {
                debugLog(`‚ùå AR failed: ${error.message}`, 'error');
                arButton.disabled = false;
                arButton.textContent = 'Try AR Again';
                showTroubleshooting('ar_failed', error);
            }
        }

        // Step 4: Help user troubleshoot problems
        function showTroubleshooting(problem, error = null) {
            const statusDiv = document.getElementById('status');
            let advice = '';
            
            switch (problem) {
                case 'no_webxr':
                    advice = `
                        <div style="text-align: left; margin-top: 10px;">
                        <strong>‚ùå WebXR not supported</strong><br>
                        Try these solutions:<br>
                        ‚Ä¢ Use Safari on iOS 15.4+ or Chrome on Android<br>
                        ‚Ä¢ Make sure you're on HTTPS (secure connection)<br>
                        ‚Ä¢ Update your browser to the latest version<br>
                        ‚Ä¢ Try Chrome browser instead of XR Browser
                        </div>
                    `;
                    break;
                    
                case 'ar_not_supported':
                    advice = `
                        <div style="text-align: left; margin-top: 10px;">
                        <strong>‚ùå AR not available</strong><br>
                        iPhone 13 solutions:<br>
                        ‚Ä¢ Use Safari (not Chrome or XR Browser)<br>
                        ‚Ä¢ Make sure iOS is 15.4 or newer<br>
                        ‚Ä¢ Grant camera permissions<br>
                        ‚Ä¢ Try reloading the page<br>
                        ‚Ä¢ Some apps like XR Browser don't work well with iPhone 13
                        </div>
                    `;
                    break;
                    
                case 'check_error':
                    advice = `
                        <div style="text-align: left; margin-top: 10px;">
                        <strong>‚ö†Ô∏è Error checking AR</strong><br>
                        Error: ${error?.message || 'Unknown'}<br>
                        Try:<br>
                        ‚Ä¢ Reload the page<br>
                        ‚Ä¢ Check internet connection<br>
                        ‚Ä¢ Grant camera permissions<br>
                        ‚Ä¢ Use Safari browser instead
                        </div>
                    `;
                    break;
                    
                case 'ar_failed':
                    advice = `
                        <div style="text-align: left; margin-top: 10px;">
                        <strong>‚ùå AR startup failed</strong><br>
                        Error: ${error?.message || 'Unknown'}<br>
                        Solutions:<br>
                        ‚Ä¢ Allow camera access when prompted<br>
                        ‚Ä¢ Make sure you have good lighting<br>
                        ‚Ä¢ Point camera at a flat surface first<br>
                        ‚Ä¢ Try closing other apps using camera<br>
                        ‚Ä¢ Reload page and try again
                        </div>
                    `;
                    break;
            }
            
            statusDiv.innerHTML += advice;
        }

        // Step 5: Handle screen rotation and resizing
        function handleResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        window.addEventListener('resize', handleResize);

        // Step 6: Start everything when page loads
        function init() {
            debugLog('üé¨ Starting Saturn AR app...', 'info');
            
            initThreeJS();
            createSaturn();
            checkARSupport();
            
            // Start animation for non-AR view
            renderer.setAnimationLoop(animate);
            
            debugLog('‚úÖ App ready!', 'success');
        }

        // Wait for page to fully load, then start
        window.addEventListener('load', init);
        
        // Show helpful info
        debugLog('üìñ Instructions: This app shows Saturn in AR on your iPhone 13', 'info');
        debugLog('üîß If AR doesn\'t work, check the troubleshooting advice above', 'info');
        
    </script>
</body>
</html>
