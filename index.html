<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Solar System AR</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
            touch-action: none;
        }
        
        .planet-info {
            position: absolute;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #ff6b35;
            max-width: 300px;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        
        .planet-info h3 {
            margin: 0 0 10px 0;
            color: #ff6b35;
            font-size: 1.4em;
        }
        
        .planet-info p {
            margin: 5px 0;
            line-height: 1.4;
        }
        
        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            color: #ff6b35;
            font-size: 1.5em;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const SolarSystemAR = () => {
            const mountRef = useRef(null);
            const sceneRef = useRef(null);
            const rendererRef = useRef(null);
            const cameraRef = useRef(null);
            const planetsRef = useRef([]);
            const sunRef = useRef(null);
            const clockRef = useRef(null);
            const raycasterRef = useRef(null);
            const mouseRef = useRef({ x: 0, y: 0 });
            
            const [arSupported, setArSupported] = useState(false);
            const [isChecking, setIsChecking] = useState(true);
            const [arActive, setArActive] = useState(false);
            const [xrSession, setXrSession] = useState(null);
            const [selectedPlanet, setSelectedPlanet] = useState(null);
            const [planetInfoPos, setPlanetInfoPos] = useState({ x: 0, y: 0 });

            // Enhanced planet data with details
            const planetData = [
                { 
                    name: 'Mercury', 
                    size: 0.3, 
                    distance: 1.0, 
                    speed: 0.8, 
                    color: 0x8c7853,
                    details: {
                        diameter: '4,879 km',
                        distance: '57.9 million km from Sun',
                        day: '176 Earth days',
                        year: '88 Earth days',
                        facts: 'Closest to the Sun, extreme temperatures'
                    }
                },
                { 
                    name: 'Venus', 
                    size: 0.35, 
                    distance: 1.4, 
                    speed: 0.6, 
                    color: 0xffc649,
                    details: {
                        diameter: '12,104 km',
                        distance: '108.2 million km from Sun', 
                        day: '243 Earth days',
                        year: '225 Earth days',
                        facts: 'Hottest planet, thick atmosphere'
                    }
                },
                { 
                    name: 'Earth', 
                    size: 0.35, 
                    distance: 1.8, 
                    speed: 0.5, 
                    color: 0x6b93d6,
                    details: {
                        diameter: '12,756 km',
                        distance: '149.6 million km from Sun',
                        day: '24 hours',
                        year: '365.25 days', 
                        facts: 'Only known planet with life'
                    }
                },
                { 
                    name: 'Mars', 
                    size: 0.28, 
                    distance: 2.3, 
                    speed: 0.4, 
                    color: 0xc1440e,
                    details: {
                        diameter: '6,792 km',
                        distance: '227.9 million km from Sun',
                        day: '24.6 hours', 
                        year: '687 Earth days',
                        facts: 'Red planet, has polar ice caps'
                    }
                },
                { 
                    name: 'Jupiter', 
                    size: 0.8, 
                    distance: 3.2, 
                    speed: 0.25, 
                    color: 0xd8ca9d,
                    details: {
                        diameter: '142,984 km',
                        distance: '778.5 million km from Sun',
                        day: '9.9 hours',
                        year: '11.9 Earth years',
                        facts: 'Largest planet, Great Red Spot'
                    }
                },
                { 
                    name: 'Saturn', 
                    size: 0.7, 
                    distance: 4.0, 
                    speed: 0.2, 
                    color: 0xfad5a5,
                    details: {
                        diameter: '120,536 km',
                        distance: '1.43 billion km from Sun', 
                        day: '10.7 hours',
                        year: '29.4 Earth years',
                        facts: 'Famous for its ring system'
                    }
                },
                { 
                    name: 'Uranus', 
                    size: 0.5, 
                    distance: 4.8, 
                    speed: 0.15, 
                    color: 0x4fd0e3,
                    details: {
                        diameter: '51,118 km',
                        distance: '2.87 billion km from Sun',
                        day: '17.2 hours', 
                        year: '84 Earth years',
                        facts: 'Tilted on its side, ice giant'
                    }
                },
                { 
                    name: 'Neptune', 
                    size: 0.48, 
                    distance: 5.5, 
                    speed: 0.1, 
                    color: 0x4b70dd,
                    details: {
                        diameter: '49,528 km',
                        distance: '4.5 billion km from Sun',
                        day: '16.1 hours',
                        year: '164.8 Earth years', 
                        facts: 'Windiest planet, deep blue color'
                    }
                }
            ];

            // Sun data for details
            const sunData = {
                name: 'The Sun',
                details: {
                    diameter: '1.39 million km',
                    distance: 'Center of Solar System',
                    temperature: '5,778 K surface / 15 million K core',
                    composition: '73% Hydrogen, 25% Helium',
                    age: '4.6 billion years',
                    facts: 'Contains 99.86% of Solar System mass, powers all life on Earth'
                }
            };

            // Camera controls state
            const cameraControls = useRef({
                isDown: false,
                startX: 0,
                startY: 0,
                rotationX: 0,
                rotationY: 0,
                zoom: 8
            });

            // Check AR support
            useEffect(() => {
                const checkARSupport = async () => {
                    if (!navigator.xr) {
                        setIsChecking(false);
                        return;
                    }

                    try {
                        const supported = await navigator.xr.isSessionSupported('immersive-ar');
                        setArSupported(supported);
                    } catch (error) {
                        setArSupported(false);
                    } finally {
                        setIsChecking(false);
                    }
                };

                checkARSupport();
            }, []);

            // Create textured material for planets
            const createPlanetMaterial = (planetInfo) => {
                const THREE = window.THREE;
                
                // Create a canvas for procedural texture
                const canvas = document.createElement('canvas');
                canvas.width = 512;
                canvas.height = 512;
                const ctx = canvas.getContext('2d');
                
                // Create gradient based on planet color
                const gradient = ctx.createRadialGradient(256, 256, 0, 256, 256, 256);
                const baseColor = new THREE.Color(planetInfo.color);
                const lighterColor = baseColor.clone().multiplyScalar(1.3);
                const darkerColor = baseColor.clone().multiplyScalar(0.7);
                
                gradient.addColorStop(0, `#${lighterColor.getHexString()}`);
                gradient.addColorStop(0.7, `#${baseColor.getHexString()}`);
                gradient.addColorStop(1, `#${darkerColor.getHexString()}`);
                
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, 512, 512);
                
                // Add some surface details
                for (let i = 0; i < 50; i++) {
                    ctx.fillStyle = `rgba(${Math.random() * 100}, ${Math.random() * 100}, ${Math.random() * 100}, 0.3)`;
                    ctx.beginPath();
                    ctx.arc(Math.random() * 512, Math.random() * 512, Math.random() * 20, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                const texture = new THREE.CanvasTexture(canvas);
                return new THREE.MeshPhongMaterial({ 
                    map: texture,
                    shininess: 30,
                    specular: 0x222222
                });
            };

            // Initialize Three.js scene
            useEffect(() => {
                if (!mountRef.current) return;

                const THREE = window.THREE;
                if (!THREE) return;

                const scene = new THREE.Scene();
                const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                const raycaster = new THREE.Raycaster();
                
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setClearColor(0x000011);
                renderer.xr.enabled = true;
                renderer.shadowMap.enabled = true;
                renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                mountRef.current.appendChild(renderer.domElement);

                // Add starfield
                const starGeometry = new THREE.BufferGeometry();
                const starMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 2 });
                const starVertices = [];
                for (let i = 0; i < 15000; i++) {
                    starVertices.push((Math.random() - 0.5) * 2000);
                    starVertices.push((Math.random() - 0.5) * 2000);
                    starVertices.push((Math.random() - 0.5) * 2000);
                }
                starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
                scene.add(new THREE.Points(starGeometry, starMaterial));

                // Position camera
                camera.position.set(0, 2, 8);
                camera.lookAt(0, 0, 0);

                const clock = new THREE.Clock();

                // Enhanced lighting
                const ambientLight = new THREE.AmbientLight(0x404040, 0.3);
                scene.add(ambientLight);
                const sunLight = new THREE.PointLight(0xffffff, 2, 50);
                sunLight.castShadow = true;
                sunLight.shadow.mapSize.width = 2048;
                sunLight.shadow.mapSize.height = 2048;
                scene.add(sunLight);

                // Create enhanced glowing sun
                const sunGroup = new THREE.Group();
                
                // Main sun body
                const sunGeometry = new THREE.SphereGeometry(0.5, 64, 64);
                
                // Create detailed sun texture
                const sunCanvas = document.createElement('canvas');
                sunCanvas.width = 1024;
                sunCanvas.height = 1024;
                const sunCtx = sunCanvas.getContext('2d');
                
                // Base sun gradient
                const sunGradient = sunCtx.createRadialGradient(512, 512, 0, 512, 512, 512);
                sunGradient.addColorStop(0, '#ffff88');
                sunGradient.addColorStop(0.3, '#ffaa00');
                sunGradient.addColorStop(0.7, '#ff6600');
                sunGradient.addColorStop(1, '#cc3300');
                
                sunCtx.fillStyle = sunGradient;
                sunCtx.fillRect(0, 0, 1024, 1024);
                
                // Add solar flares and surface activity
                for (let i = 0; i < 100; i++) {
                    const x = Math.random() * 1024;
                    const y = Math.random() * 1024;
                    const size = Math.random() * 50 + 10;
                    
                    const flareGradient = sunCtx.createRadialGradient(x, y, 0, x, y, size);
                    flareGradient.addColorStop(0, 'rgba(255,255,255,0.8)');
                    flareGradient.addColorStop(0.5, 'rgba(255,200,0,0.4)');
                    flareGradient.addColorStop(1, 'rgba(255,100,0,0.1)');
                    
                    sunCtx.fillStyle = flareGradient;
                    sunCtx.beginPath();
                    sunCtx.arc(x, y, size, 0, Math.PI * 2);
                    sunCtx.fill();
                }
                
                const sunTexture = new THREE.CanvasTexture(sunCanvas);
                const sunMaterial = new THREE.MeshStandardMaterial({ 
                    map: sunTexture,
                    emissive: 0xffaa00,
                    emissiveIntensity: 0.7,
                    emissiveMap: sunTexture
                });
                
                const sun = new THREE.Mesh(sunGeometry, sunMaterial);
                
                // Add sun corona (outer glow)
                const coronaGeometry = new THREE.SphereGeometry(0.65, 32, 32);
                const coronaMaterial = new THREE.MeshBasicMaterial({
                    color: 0xffaa00,
                    transparent: true,
                    opacity: 0.3,
                    side: THREE.BackSide
                });
                const corona = new THREE.Mesh(coronaGeometry, coronaMaterial);
                
                sun.userData = sunData;
                sunGroup.add(sun);
                sunGroup.add(corona);
                scene.add(sunGroup);

                // Create planets with enhanced materials
                const planets = [];
                planetData.forEach((planetInfo) => {
                    const geometry = new THREE.SphereGeometry(planetInfo.size, 32, 32);
                    const material = createPlanetMaterial(planetInfo);
                    const planet = new THREE.Mesh(geometry, material);
                    
                    planet.castShadow = true;
                    planet.receiveShadow = true;
                    planet.userData = {
                        ...planetInfo,
                        angle: Math.random() * Math.PI * 2
                    };
                    
                    const angle = planet.userData.angle;
                    planet.position.x = Math.cos(angle) * planetInfo.distance;
                    planet.position.z = Math.sin(angle) * planetInfo.distance;
                    
                    scene.add(planet);
                    planets.push(planet);
                });

                // Mouse and touch event handlers
                const handlePointerDown = (event) => {
                    if (arActive) return;
                    
                    const controls = cameraControls.current;
                    controls.isDown = true;
                    
                    const clientX = event.touches ? event.touches[0].clientX : event.clientX;
                    const clientY = event.touches ? event.touches[0].clientY : event.clientY;
                    
                    controls.startX = clientX;
                    controls.startY = clientY;
                };

                const handlePointerMove = (event) => {
                    if (arActive) return;
                    
                    const controls = cameraControls.current;
                    const clientX = event.touches ? event.touches[0].clientX : event.clientX;
                    const clientY = event.touches ? event.touches[0].clientY : event.clientY;
                    
                    if (controls.isDown) {
                        const deltaX = clientX - controls.startX;
                        const deltaY = clientY - controls.startY;
                        
                        controls.rotationY += deltaX * 0.01;
                        controls.rotationX += deltaY * 0.01;
                        controls.rotationX = Math.max(-Math.PI/2, Math.min(Math.PI/2, controls.rotationX));
                        
                        controls.startX = clientX;
                        controls.startY = clientY;
                    }
                };

                const handlePointerUp = () => {
                    cameraControls.current.isDown = false;
                };

                const handleClick = (event) => {
                    if (arActive || cameraControls.current.isDown) return;
                    
                    const rect = renderer.domElement.getBoundingClientRect();
                    const mouse = {
                        x: ((event.clientX - rect.left) / rect.width) * 2 - 1,
                        y: -((event.clientY - rect.top) / rect.height) * 2 + 1
                    };
                    
                    raycaster.setFromCamera(mouse, camera);
                    
                    // Check for sun click first
                    const sunIntersects = raycaster.intersectObjects([sun]);
                    if (sunIntersects.length > 0) {
                        setSelectedPlanet(sunData);
                        setPlanetInfoPos({ x: event.clientX, y: event.clientY });
                        return;
                    }
                    
                    // Then check planets
                    const intersects = raycaster.intersectObjects(planets);
                    if (intersects.length > 0) {
                        const planet = intersects[0].object;
                        setSelectedPlanet(planet.userData);
                        setPlanetInfoPos({ x: event.clientX, y: event.clientY });
                    } else {
                        setSelectedPlanet(null);
                    }
                };

                const handleWheel = (event) => {
                    if (arActive) return;
                    
                    const controls = cameraControls.current;
                    controls.zoom += event.deltaY * 0.001;
                    controls.zoom = Math.max(2, Math.min(20, controls.zoom));
                };

                // Add event listeners
                renderer.domElement.addEventListener('mousedown', handlePointerDown);
                renderer.domElement.addEventListener('mousemove', handlePointerMove);
                renderer.domElement.addEventListener('mouseup', handlePointerUp);
                renderer.domElement.addEventListener('click', handleClick);
                renderer.domElement.addEventListener('wheel', handleWheel);
                
                // Touch events
                renderer.domElement.addEventListener('touchstart', handlePointerDown, { passive: true });
                renderer.domElement.addEventListener('touchmove', handlePointerMove, { passive: true });
                renderer.domElement.addEventListener('touchend', handlePointerUp, { passive: true });

                // Animation loop
                const animate = () => {
                    const deltaTime = clock.getDelta();
                    const controls = cameraControls.current;
                    
                    // Update camera position based on controls
                    if (!arActive) {
                        const radius = controls.zoom;
                        camera.position.x = radius * Math.sin(controls.rotationY) * Math.cos(controls.rotationX);
                        camera.position.y = radius * Math.sin(controls.rotationX);
                        camera.position.z = radius * Math.cos(controls.rotationY) * Math.cos(controls.rotationX);
                        camera.lookAt(0, 0, 0);
                    }
                    
                    // Animate sun
                    if (sunGroup) {
                        sunGroup.rotation.y += deltaTime * 0.2;
                        // Add subtle corona pulsing
                        const corona = sunGroup.children[1];
                        if (corona) {
                            corona.material.opacity = 0.3 + Math.sin(clock.getElapsedTime() * 2) * 0.1;
                        }
                    }
                    
                    // Animate planets (much slower)
                    planets.forEach(planet => {
                        planet.userData.angle += deltaTime * planet.userData.speed * 0.01; // Much slower
                        const distance = planet.userData.distance;
                        const angle = planet.userData.angle;
                        
                        planet.position.x = Math.cos(angle) * distance;
                        planet.position.z = Math.sin(angle) * distance;
                        planet.rotation.y += deltaTime * 0.3; // Slower planet rotation
                    });
                    
                    renderer.render(scene, camera);
                };

                renderer.setAnimationLoop(animate);

                // Store refs
                sceneRef.current = scene;
                rendererRef.current = renderer;
                cameraRef.current = camera;
                planetsRef.current = planets;
                sunRef.current = sunGroup;
                clockRef.current = clock;
                raycasterRef.current = raycaster;

                const handleResize = () => {
                    camera.aspect = window.innerWidth / window.innerHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(window.innerWidth, window.innerHeight);
                };
                window.addEventListener('resize', handleResize);

                return () => {
                    window.removeEventListener('resize', handleResize);
                    renderer.setAnimationLoop(null);
                    if (mountRef.current && renderer.domElement) {
                        mountRef.current.removeChild(renderer.domElement);
                    }
                    renderer.dispose();
                };
            }, [arActive]);

            const showARRequirements = () => {
                const requirements = [
                    "✓ Chrome 81+ on Android OR Safari on iOS 15.4+",
                    "✓ Device with ARCore support (Android) or LiDAR (newer iPhones/iPads)", 
                    "✓ Camera permissions granted",
                    "✓ Secure HTTPS connection",
                    "✓ Sufficient lighting in your environment"
                ];
                
                alert(`AR Requirements:\n\n${requirements.join('\n')}\n\nYour device: ${navigator.userAgent.includes('iPhone') ? 'iOS' : 'Android/Desktop'}\nWebXR support: ${navigator.xr ? 'Available' : 'Not found'}`);
            };

            const startAR = async () => {
                if (!rendererRef.current) return;
                
                if (!arSupported) {
                    showARRequirements();
                    return;
                }

                try {
                    // Simplify AR session request to avoid freezing
                    const session = await navigator.xr.requestSession('immersive-ar');

                    // Position solar system for AR (smaller scale)
                    if (sunRef.current) {
                        sunRef.current.position.set(0, 1.0, -2);
                        sunRef.current.scale.setScalar(0.3); // Scale down for AR
                        
                        planetsRef.current.forEach(planet => {
                            const angle = planet.userData.angle;
                            const distance = planet.userData.distance * 0.3; // Much closer in AR
                            planet.position.x = Math.cos(angle) * distance;
                            planet.position.y = 1.0;
                            planet.position.z = -2 + Math.sin(angle) * distance;
                            planet.scale.setScalar(0.3); // Scale down planets too
                        });
                    }

                    await rendererRef.current.xr.setSession(session);
                    setXrSession(session);
                    setArActive(true);

                    session.addEventListener('end', () => {
                        // Reset to normal mode
                        if (sunRef.current) {
                            sunRef.current.position.set(0, 0, 0);
                            sunRef.current.scale.setScalar(1);
                            
                            planetsRef.current.forEach(planet => {
                                const angle = planet.userData.angle;
                                const distance = planet.userData.distance;
                                planet.position.x = Math.cos(angle) * distance;
                                planet.position.y = 0;
                                planet.position.z = Math.sin(angle) * distance;
                                planet.scale.setScalar(1);
                            });
                        }

                        setArActive(false);
                        setXrSession(null);
                    });

                } catch (error) {
                    console.error('AR Error:', error);
                    showARRequirements();
                }
            };

            return React.createElement('div', {
                style: { 
                    position: 'relative',
                    width: '100vw', 
                    height: '100vh',
                    background: '#000011',
                    color: 'white',
                    fontFamily: 'Arial, sans-serif',
                    overflow: 'hidden'
                }
            }, [
                // Three.js mount
                React.createElement('div', {
                    key: 'mount',
                    ref: mountRef,
                    style: { position: 'absolute', top: 0, left: 0 }
                }),
                
                // Title
                React.createElement('div', {
                    key: 'title',
                    style: {
                        position: 'absolute',
                        top: '15px',
                        left: '15px',
                        zIndex: 10,
                        background: 'rgba(0,0,0,0.8)',
                        padding: '10px 20px',
                        borderRadius: '10px',
                        border: '1px solid rgba(255,255,255,0.2)'
                    }
                }, [
                    React.createElement('h2', {
                        key: 'h2',
                        style: { 
                            margin: 0,
                            fontSize: '1.3em',
                            background: 'linear-gradient(45deg, #ff6b35, #f7931e)',
                            WebkitBackgroundClip: 'text',
                            WebkitTextFillColor: 'transparent'
                        }
                    }, `🌞 Solar System ${arActive ? 'AR' : '3D'}`),
                    !arActive && React.createElement('p', {
                        key: 'instructions',
                        style: { margin: '5px 0 0 0', fontSize: '0.8em', opacity: 0.9 }
                    }, '🖱️ Drag to orbit • 🔄 Zoom • 👆 Click planets for info')
                ]),

                // AR Control
                React.createElement('button', {
                    key: 'ar-btn',
                    onClick: startAR,
                    style: {
                        position: 'absolute',
                        top: '15px',
                        right: '15px',
                        padding: '12px 18px',
                        fontSize: '1em',
                        background: arSupported 
                            ? 'linear-gradient(45deg, #ff6b35, #f7931e)' 
                            : 'linear-gradient(45deg, #666, #888)',
                        color: 'white',
                        border: 'none',
                        borderRadius: '20px',
                        cursor: 'pointer',
                        zIndex: 10
                    }
                }, arActive ? 'Exit AR' : (arSupported ? '🚀 Launch AR' : '🚀 AR Info')),

                // Planet info popup
                selectedPlanet && React.createElement('div', {
                    key: 'planet-info',
                    className: 'planet-info',
                    style: {
                        left: Math.min(planetInfoPos.x, window.innerWidth - 320) + 'px',
                        top: Math.min(planetInfoPos.y, window.innerHeight - 250) + 'px'
                    }
                }, [
                    React.createElement('button', {
                        key: 'close',
                        className: 'close-btn',
                        onClick: () => setSelectedPlanet(null)
                    }, '×'),
                    React.createElement('h3', { key: 'name' }, `🪐 ${selectedPlanet.name}`),
                    React.createElement('p', { key: 'diameter' }, `📏 Diameter: ${selectedPlanet.details.diameter}`),
                    React.createElement('p', { key: 'distance' }, `🚀 Distance: ${selectedPlanet.details.distance}`),
                    React.createElement('p', { key: 'day' }, `🌅 Day: ${selectedPlanet.details.day}`),
                    React.createElement('p', { key: 'year' }, `🗓️ Year: ${selectedPlanet.details.year}`),
                    React.createElement('p', { key: 'facts', style: { fontStyle: 'italic', color: '#ffa500' } }, selectedPlanet.details.facts)
                ]),

                // Bottom info
                React.createElement('div', {
                    key: 'bottom-info',
                    style: {
                        position: 'absolute',
                        bottom: '15px',
                        left: '15px',
                        right: '15px',
                        background: 'rgba(0,0,0,0.8)',
                        padding: '12px',
                        borderRadius: '10px',
                        textAlign: 'center',
                        fontSize: '0.85em',
                        zIndex: 10
                    }
                }, arActive ? 
                    '📱 Move your phone to see the solar system in your space!' : 
                    '🪐 Interactive Solar System • Click planets for details • Drag to explore'
                )
            ]);
        };

        const { createRoot } = ReactDOM;
        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(SolarSystemAR));
    </script>
</body>
</html>
